# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных используемые в приложении

Интерфейс состояния приложения

```
interface IHomePage {
  catalog: IProduct[];
  basket: string[];
  order: IOrder | null;
  basketTotal: number; 
  preview: string | null;
}
```

Интерфейс карточки товара

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
  index:  number;
}
```

Интерфейс оформления заказа

```
interface IOrder {
  payment: string;
  email: string;
  phone: string;
  address: string;
  items: string[];
  total: number;
}
```

Интерфейс состояния формы 

```
interface IFormState {
  valid: boolean;
  errors: string[];
}
```

Интерфейс модального окна 

```
interface IModal {
  content: HTMLElement;
}
```

Интерфейс корзины 
```
interface IBasket {
  goods: HTMLElement[];
  total: number | null;
  selected: number
}
```

Интерфейс главной страницы приложения

```
interface IPage {
  counter: number;
  catalog: HTMLElement[];
  locked: boolean;
}

Интерфейс отслеживания изменения формы

```
interface IProductActions {
  onClick: (event: MouseEvent) => void;
}
```

Интерфейс окна подтверждения 

```
interface ISuccess {
  total: number;
}
```

Интерфейс результата отправки заказа на сервер

```
interface IOrderResult {
  id: string;
}
```

Интерфейс при получении ответа от сервера

```
interface IApi {
  getGoods: () => Promise<IProduct[]>
  orderGoods(order: IOrder): Promise<IOrderResult>
}
```

Тип метода API

```
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE';
```

Тип определяющий работу с полями заказа

```
type TOrder = Pick<IOrder, 'payment' | 'address' | 'email' | 'phone'>;
```

## Архитектура приложения

При разработке приложения используется парадигма MVP (Model-View-Presenter).

MVP разделяет приложение на три основных компонента (слоя):

Модель (Model) — представляет бизнес-логику приложения и данные.
Представление (View) — отображает данные пользователю и обрабатывает пользовательский ввод.
Презентер (Presenter) — является посредником между моделью и представлением.

Основная идея MVP заключается в том, чтобы разделить ответственность между компонентами так, чтобы изменения в одном компоненте не влияли на другие. Слои связаны между собой, но ничего не знают друг о друге.

### Слой модель

#### class Api

Состоит из набора правил, описывающих, логику отправки запросов на сервер и получения ответа.

`constructor(commonUrl: string, options: RequestInit = {})`- принимает основной URL и глобальные опции для всех запросов (опционально).

Методы: 

- `handleResponse(response: Response)` - метод, который принимает ответ сервера и возвращает либо промис содержащий данные либо причину возникновения ошибки;

- `get` - выполняет GET-запрос и возвращает промис с объектом, полученным от сервера;

- `post` - принимает объект для передачи запроса серверу в JSON, по умолчанию выполняется POST-запрос, который может быть переопределен, если задан 3-й параметр;

#### class EventEmitter

Обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.

Основные методы класса:
- `on` - установка обработчика на событие;
- `off` - снятие обработчика с события;
- `emit` - инициализировать события с данными;
- `trigger` - коллбек триггер, генерирующий событие при вызове;

Также в классе реализованы следующие дополнительные методы:
- `onAll` -  слушать все события;
- `offAll` - сбросить все обработчики.

#### Базовые классы

##### class Component<T>

Дженерик для всех компоненов слоя представления данных, принимает тип объекта, в котором данные будут рендериться для отображения в компоненте.

`constructor (element: HTMLElement)` -  конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента.

Методы: 

- `toggleClass(element: HTMLElement, className: string, force?: boolean)` - переключение класса;
- `setText(element: HTMLElement, value: unknown)` - установить текстовое содержимое;
- `setDisabled(element: HTMLElement, state: boolean)` - установить статус блокировки;
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - установить изображение;
- `render(data?: Partial<T>): HTMLElement` - рендер корневого DOM-элемента.

##### class Model

Базовая модель данных, создаётся для того, чтобы ее можно было отличить от простых объектов с данными.

`constructor(data: Partial<T>, protected events: IEvents)` - конструктор принимает данные и экземпляр EventEmitter

Методы: 

- `emitChanges(event: string, payload?: object)` - сообщает всем что модель изменилась.

### Слой данных

#### class AppState

Используется как расширение класса Model, сохраняет данные о приложении.

Содержит поля:
- `_goods`: IProduct[] - товары;
- `_order`: IOrder - заказ;
- `_basket`: IProduct[] = [] - корзина;
- `_preview: string | null;` - выбранный товар;
- `events`: IEvents - экземпляр брокера событий;
- `formErrors: FormErrors = {}` - ошибки формы.

Методы: 
- `set` - для работы с вышеперечисленными полями;
- `get` - для работы с вышеперечисленными полями;
- `getProduct(cardId: string)` - получение id карточки товара для отображения выбранного товара;
- `clearBasket()` - очищение корзины полностью;
- `toBasket(product: IProduct)` - добавление товара в корзину;
- `deleteFromBasket(product: IProduct)` - удаление товара из корзины;
- `setTotal()` - подсчет общей стоимости добавленных в корзину товаров;
- `validateOrder()` - валидация формы заказа;
- `validateContacts()` - валидация формы контактов;
- `setOrderField(input: keyof TOrder, value: string)` - передаем заказ как объект для отправки на сервер.

### Слой представления

Все классы представления отвечают за отображение внутри DOM-элемента передаваемых в них данных. 

#### class Modal<IModal>

Реализует модальное окно. Также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру для закрытия модального окна по нажатию кнопки Esc, клика по оверлею и кнопке-крестику. 

- `constructor (container: HTMLElement, events: IEvents)`. Конструктор принимает DOM-элемент, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_content: HTMLElement` - элемент модального окна
- `_closeButton` - кнопка закрытия

Методы класса: 

- `set` - отображение контента;
- `open` - открывает модальное окно, добавляет слушатель на весь элемент;
- `close` - закрывает модальное окно, удаляет слушателей;
- `_toggleStateModal` - изменяет класс, который открывает\закрывает модальное окно;
- `_closeModalbyEsc` - закрывает модальное окно по клавише Esc.

#### class Form<IOrder>

Дженерик, используется как расширение класса Component.

- `constructor (container: HTMLElement, events: IEvents)`. Конструктор принимает DOM-элемент, по которому в разметке страницы будет идентифицирована форма и экземпляр класса `EventEmitter` для возможности инициации событий. Содердит слушатели сабмитов и инпутов.

Поля класса: 

- `submitBtn: HTMLButtonElement` - кнопка сабмита;
- `formName: string` - название формы;
- `_errors: HTMLElement` - ошибки формы;
- `_form: HTMLFormElement` - элемент формы;

Методы класса: 

- `onInputChange(input: keyof IOrder, value: string)` - создан для инициализации события и передачи введённых данных в заказ;
- `set` - отображение валидации и ошибок;
- `close` - очищает форму при закрытии модального окна;
- `render` - рендерит ошибки формы.

#### class OrderForm

Используется для расширения класс Form. Реализует модальное окно в котором содержится форма для заполнения с полями ввода. При сабмите инициализирует событие, передает введённые в форму данные, а так же их изменения. Позволяет управлять активностью кнопки сохранения. 

- `constructor (container: HTMLElement, events: IEvents)`. Конструктор принимает DOM-элемент, по которому в разметке страницы будет идентифицирована форма, кнопки выбора способа оплаты и экземпляр класса `EventEmitter` для возможности инициации событий. Содердит слушатели сабмитов и инпутов.

Поля класса: 

- `cash: HTMLButtonElement` - кнопка выбора оплаты  - при наличными при получении;
- `card: HTMLButtonElement` - кнопка выбора оплаты - картой;
- `_address: HTMLInputElement`- поле для ввода адреса;
- `_payment: string` - напоминание о выборе типа оплаты.

Методы: 

- `set` - получение адреса;
- `setPayment(button: HTMLButtonElement)` - установка способа оплаты;
- `toggleStateCard(state: boolean = true)` - переключение кнопки "оплата картой";
- `toggleStateCash(state: boolean = true)` - переключение кнопки "оплата наличными".

#### class ContactsForm

Используется для расширения класса Form. Реализует модальное окно в котором содержится форма для заполнения с полями ввода. При сабмите инициализирует событие, передает введённые в форму данные, а так же их изменения. Позволяет управлять активностью кнопки сохранения. 

- `constructor (container: HTMLElement, events: IEvents)`. Конструктор принимает DOM-элемент, по которому в разметке страницы будет идентифицировано поле формы и экземпляр класса `EventEmitter` для возможности инициации событий. Содердит слушатели сабмитов и инпутов.

Поля класса: 

- `_email` - инпут для адреса эл.почты;
- `_phone` - инпут для номера телефона.

Методы: 

- `set` - для получения адреса эл.почты и номера телефона;

#### class Basket

Используется для расширения базового класса Component. 

- `constructor (container: HTMLElement, events: IEvents)`. Конструктор принимает DOM-элемент, по которому в разметке страницы будут идентифицированы компоненты корзины и экземпляр класса `EventEmitter` для возможности инициации событий. Содержит слушатель кликов. 

Поля класса: 

- `_list` - список товаров;
- `_total` - подсчёт итоговой суммы заказа;
- `_button` - кнопка заказа.

Методы: 

- `set` - получение значений;
  - количества заказанных товаров;
  - выбранных для заказа товаров;
  - итоговой суммы заказы.

#### class Product

Используется для отображения карточки товара со всеми её полями, содержащимися в разметке. В классе устанавливаются слушатели на все элементы, при взаимодействии с которыми генерируются события.

`constructor(blockName: string, container: HTMLElement, actions?: IProductActions)` -   конструктор класса в котором инициализируется DOM-элемент темплейта, при таком подходе есть возможность формировать различные варианты отображения карточки и экземпляр `EventEmitter` для инициации событий.

Поля класса:

- `_title` - наименование товара;
- `_image` - картинка;
- `_category` - категория товара;
- `price` - цена товара;
- `_description` - описание товара;
- `_button` - кнопка добавления товара;
- `_index` - индекс товара в массиве.

Методы класса:

- `set` - сеттер для получения значения каждого из перечисленных полей;
- `get` - геттер для кнопки.

#### class Success 

Используется для модального окна, отображающегося при успешном выполнении заказа, расширяет базовый класс Component.

`constructor(container: HTMLElement, actions: ISuccessActions)` -   конструктор класса в котором инициализируется DOM-элемент успешного выполнения заказа, и экземпляр `ISuccessActions` для инициации клика.

Поля класса: 

- `_close` - кнопка закрытия модального окна;
- `_total` - общая сумма заказа.

Методы класса:

- `set` - для получения значения суммы заказа.

#### class Page

используется для отображения главной страницы приложения. Расширяет базовый класс Component. 

`constructor(container: HTMLElement, events: IEvents)` -   конструктор класса в котором инициализируются DOM-элементы компонентов главной страницы приложения, и экземпляр `EventEmitter` для инициации событий.

Поля класса: 

- `_counter: HTMLElement` - счётчик количества элементов корзины;
- `_catalog: HTMLElement` - контейнер с товарами;
- `_wrapper: HTMLElement` - контейнер для главной страницы;
- `_basket: HTMLElement` - элемент корзины.

Методы класса:

- `set` - для получения значений:
    - счётчика;
    - контейнера с товарами;
    - переключатель состояния страницы.

### Слой презентер

#### class commonApi

Используется для взаимодействия с бэкендом приложения, принимает в конструктор экземпляр класса Api.

`constructor(cdn: string, commonUrl: string, options?: RequestInit)` - принимает в параметры cdn, базовый Url и опции (которые являются не обязательным параметром)

Поля класса: 

`readonly cdn: string;` - cdn.

Методы класса: 

- `getGoods(): Promise<IProduct[]> ` - получение массива карточек товаров с сервера;
- `orderGoods(order: IOrder): Promise<IOrderResult>` - заказ товаров, реализуемый при помощи метода `POST`.

## Описание событий

*Список возможных событий приложения:*

- `goods:loaded`- загрузка всех товаров с сервера;
- `modal:open` - открытие модального окна;
- `modal:close` - закрытие модального окна;
- `card:select` - выбор карточки для отображения в модальном окне;
- `card:addtocart` - добавление товара в корзину;
- `card:deletefromcart`  - удаление товара из корзины;
- `basket:open` - открытие корзины;
- `order:open` - открытие заказа;
- `order:submit` - отправка заказа;
- `formErrors:change` - наличие ошибок в форме.

`index.ts` - файл, выполняющий роль презентера, соединяет между собой данные и их представление. Брокеры и обработчики событий позволяют осуществить это взаимодействие, соединить слой данных и слой представления таким образом, чтобы они не знали друг о друге. Для этого создаются экземпляры всех классов, а затем настраивается обработка событий.

