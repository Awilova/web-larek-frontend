# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных используемые в приложении

"Web-Larek" использует интерфейсы для определения структуры данных и взаимодействий в приложении.

### `ITotalItems<T>`
Представляет общее количество элементов и их список.

- **Поля:**
  - `total: number` — Общее количество элементов.
  - `items: T[]` — Массив элементов.

### `IBasketCard`
Описывает отдельный товар в корзине.

- **Поля:**
  - `title: string` — Название товара.
  - `price: number` — Цена товара.

### `ILarekApi`
Определяет методы API для работы с товарами и заказами.

- **Методы:**
  - `getProductList(): Promise<IProduct[]>` — Получает список товаров.
  - `getProductItem(id: string): Promise<IProduct>` — Получает информацию о товаре по ID.
  - `orderProduct(order: IOrderForm): Promise<IOrderResult>` — Отправляет данные заказа на сервер.

### `IModal`
Управляет отображением модальных окон.

- **Поля:**
  - `content: HTMLElement` — Содержимое модального окна.

### `IProduct`
Описывает структуру данных товара в каталоге.

- **Поля:**
  - `id: string` — Уникальный идентификатор.
  - `description: string` — Описание товара.
  - `index?: number` — Порядковый номер (опционально).
  - `image?: string` — URL изображения (опционально).
  - `title: string` — Название.
  - `category: string` — Категория.
  - `price: number | null` — Цена.

### `IPageData`
Интерфейс страницы, описывающий элементы управления и содержимое.

- **Поля:**
  - `counter: number` — Счетчик товаров в корзине.
  - `catalog: HTMLElement[]` — Массив элементов каталога.
  - `locked: boolean` — Статус блокировки страницы.

### `IBasketData`
Описывает структуру данных корзины покупок.

- **Поля:**
  - `items: HTMLElement[]` — Список товаров в корзине.
  - `total: number` — Общая стоимость товаров.

### `ISuccess`
Описывает данные для отображения успешного завершения операции.

- **Поля:**
  - `total: string` — Итоговая сумма.

### `ISuccessActions`
Определяет действия в случае успешного выполнения операции.

- **Поля:**
  - `onClick: () => void` — Функция, вызываемая при клике на элемент.

### `IContactsOrder`
Определяет структуру формы для контактных данных.

- **Поля:**
  - `phone: string` — Номер телефона.
  - `email: string` — Электронная почта.

### `IOrderForm`
Описывает форму заказа.

- **Поля:**
  - `payment: PaymentMethod` - Выбор способа оплаты.
	- `email: string` - Электронная почта.
	- `phone: string` - Контактный телефон.
	- `address: string` - Адрес доставки.
	- `total: number` - Стоимость выбранных товаров.
	- `items: string[]` - Выбранные товары.

### `IOrderResult`
Описывает результат обработки заказа.

- **Поля:**
  - `id: string` — Идентификатор заказа.
  - `total: number` — Итоговая сумма заказа.


# Архитектура приложения
```

Проект построен на основе архитектурного шаблона Model-View-Presenter (MVP), что позволяет разделить логику приложения и его интерфейс, создавая устойчивую и легко расширяемую структуру.

- **Model** — компонент, отвечающий за бизнес-логику и обработку данных, включая взаимодействие с серверным API.
- **View** — отвечает за визуальное отображение данных и управление пользовательским интерфейсом.
- **Presenter** — связывает Model и View, управляет пользовательскими действиями и обновляет представление на основе изменений в модели.
```

# Базовый код

## `class Api`

Класс `Api` предоставляет основные возможности для выполнения HTTP-запросов к серверу.

- **Конструктор:**
  - `baseUrl: string` — Базовый URL для API запросов.
  - `options: RequestInit` — Настройки запросов по умолчанию.

- **Методы:**
  - `get(uri: string): Promise<object>` — Выполняет GET-запрос.
  - `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` — Выполняет POST-запрос.
  - `handleResponse(response: Response): Promise<object>` — Обрабатывает и возвращает ответ от сервера.

## `class EventEmitter`

Класс `EventEmitter` реализует шаблон "Наблюдатель", позволяя компонентам подписываться на события и реагировать на их изменения.

- **Конструктор:**
  - Инициализирует структуру хранения событий.

- **Методы:**
  - `on(event: EventName, callback: (data: T) => void)` — Подписывает на событие.
  - `onAll(callback: (event: EmitterEvent) => void)` — Подписывает на все события.
  - `off(eventName: EventName, callback: Subscriber)` — Отписывает от события.
  - `offAll(): void` — Удаляет все подписки на события.
  - `emit(event: string, data?: T)` — Инициирует событие.
  - `trigger(event: string, context?: Partial<T>)` — Создает коллбек-триггер для инициирования события.

## `abstract class Component`

Абстрактный класс `Component` служит основой для всех UI-компонентов, предоставляя базовые методы для работы с DOM.

- **Конструктор:** 
  - Принимает DOM-элемент, представляющий контейнер компонента.

- **Методы:**
  - Методы для управления классами, текстом, состоянием и видимостью элементов.
  - `render(data?: Partial<T>): HTMLElement` — Рендеринг компонента, должен быть переопределен в производных классах.

## `abstract class Model`
Абстрактный класс `Model` служит основой для создания моделей данных, управляющих состоянием и взаимодействиями.

- **Конструктор:**
  - `constructor(data: Partial<T>, protected events: IEvents)` - Инициализирует модель данными и событийному менеджеру.

- **Методы:**
  - `emitChanges(event: string, payload?: object): void` — Генерирует событие об изменении модели.


# Model-View-Presenter (MVP)

## Модель (Model)
Компоненты модели данных

### `class Product`
Класс `Product` представляет модель товара и наследует от абстрактного класса `Model`. Он включает специфические для товара свойства и методы.

- **Поля:**
  - `id: string` — Уникальный идентификатор товара.
  - `description: string` — Описание товара.
  - `image: string` — Изображение товара.
  - `title: string` — Название товара.
  - `category: string` — Категория товара.
  - `price: number | null` — Цена товара.

### `class AppStateModel`
Класс `AppStateModel`, расширяющий `Model` и реализующий интерфейс `IAppState`, управляет глобальным состоянием приложения.

- **Поля:**
  - `basket: Product[]` — Список товаров в корзине.
  - `catalog: Product[]` — Полный каталог товаров.
  - `order: IOrderForm` — Текущий заказ.
  - `prewiew: string | null` — Статус отображения.
  - `formErrors: FormErrors` — Ошибки в форме заказа.

- **Методы:**
  - `putInBasket(product: Product)` — Добавляет товар в корзину.
  - `deleteFromBasket(product: Product)` — Удаляет товар из корзины.
  - `defaultOrder()` — Инициализирует пустой заказ.
  - `clearBasket()` — Очищает корзину.
  - `getTotal()` — Возвращает общую стоимость товаров в корзине.
  - `setCatalog(catalog: Product[])` — Обновляет каталог товаров.
  - `fullBasket(): IProduct[]` - Возвращает все добаленные товары в корзину.
  - `checkBasket(item: IProduct)` - проверяет добавление товара в корзину.
  - `setPreview(item: Product)` - Отображает добавленный товар в корзину.
  - `setOrder(): void` — Задает цену и количество товаров в заказе.
  - `validateOrderPayment()` — Валидирует способ оплаты.
  - `validateOrderForm()` — Валидирует поля ввода.
  - `setContactField(field: keyof IContactsOrder, value: string): void` - инициализирует поля контактов.

## View (Представление)
Компоненты представления

### `class ContactsOrder`
Класс `ContactsOrder` расширяет `Form` и добавляет методы для управления контактными данными.

### `class Page`
Класс `Page` управляет основными элементами интерфейса, включая счётчик товаров, каталог и блокировку страницы.

- **Поля:**
  - `counter`: Обновляет количество товаров в корзине.
  - `catalog`: Обновляет и отображает товары в каталоге.
  - `locked`: Управляет блокировкой интерфейса.

- **Методы:**
  - Конструктор класса принимает элемент контейнера и объект событий.
  - `set counter(value: number)`: Обновляет счётчик товаров.
  - `set catalog(items: HTMLElement[])`: Обновляет каталог товаров.
  - `set locked(value: boolean)`: Блокирует или разблокирует интерфейс.

### `class Card`
Класс `Card` представляет карточку товара, отображая информацию о товаре и предоставляя интерфейс для взаимодействия.

- **Поля:**
  - `_title: HTMLElement` — DOM-элемент для названия товара.
  - `_category: HTMLElement` — DOM-элемент для категории товара.
  - `_image: HTMLImageElement` — DOM-элемент для картинки товара.
  - `_price: HTMLElement` — DOM-элемент для цены товара.
  - `_description?: HTMLElement` — DOM-элемент для описания товара (опционально).
  - `_button?: HTMLButtonElement` - Кнопка добавления товара в корзину(опционально).

- **Методы:**
  - `constructor(blockName: string, container: HTMLElement, actions?: ICardActions)` — Инициализирует карточку товара.
  - Сеттеры и геттеры для работы с данными карточки.

### `class Basket`
Класс `Basket`, унаследованный от `Component` и реализующий `IBasketData`, управляет взаимодействием с корзиной покупок.

- **Поля:**
  - `_itemList: HTMLElement` - DOM-элемент для списка товаров.
  - `_totalPrice: HTMLElement` - DOM-элемент для общей стоимости товаров.
  - `_orderButton: HTMLElement` - Кнопка оформления заказа.

- **Методы:**
  - `set total(total: number)` - Обновляет общую стоимость товаров.
  - `set items(items: HTMLElement[])` - Обновляет список товаров.

### `class BasketCard`
Класс `BasketCard` отвечает за представление товара в корзине, отображая его информацию и обрабатывая события.

- **Поля:**
  - `_index: HTMLElement` - DOM-элемент для порядкового номера товара.
  - `_title: HTMLElement` - DOM-элемент для названия товара.
  - `_button: HTMLElement` - Кнопка для удаления товара.
  - `_price: HTMLElement` - DOM-элемент для цены товара.
  
- **Методы:**
  - `set title(value: string)` - Устанавливает название товара.
  - `set price(value: number)` - Устанавливает цену товара.
  - `set index(value: number)` - Устанавливает порядковый номер товара.

### `class Modal`
Класс `Modal` наследует от `Component` и реализует управление модальными окнами.

- **Поля:**
  - `content: HTMLElement` — Содержимое модального окна.
  - `_closeButton: HTMLButtonElement` - Кнопка закрытия модального окна.

- **Методы:**
  - `open()` - Открывает модальное окно.
  - `close()` - Закрывает модальное окно.
  - `render(data: IModal)` - Рендерит модальное окно с переданными данными.

### `class Form`
Класс `Form`, расширяющий `Component` и реализующий `IFormState`, управляет формой заказа.

- **Поля:**
  - `_submit: HTMLButtonElement` - Кнопка отправки формы.
  - `_errors: HTMLElement` - Сообщение об ошибках.

- **Методы:**
  - `onInputChange(field: keyof T, value: string)` - Обрабатывает изменения в форме.
  - `render(state: Partial<T> & IFormState)` - Рендерит форму с текущим состоянием.

### `class OrderForm`
Класс `OrderForm` представляет форму заказа и управляет её элементами.

- **Поля:**
  - `container`: Контейнер формы.
  - `events`: Объект для управления событиями.

- **Методы:**
  - `setButtonClass(name: string): void` — Устанавливает класс активной кнопки.

### `class Success`
Класс `Success` отображает сообщение о завершении заказа.

- **Поля:**
  - `total: string` — Общая сумма списания.

- **Методы:**
  - `set total(value: string)` — Устанавливает и отображает сумму списания.

## Presenter (Презентер)
Презентер управляет взаимодействиями между моделью и представлением, обеспечивая их синхронизацию. В данном проекте роль презентера реализована в файле index.ts.

```
*Список возможных событий приложения:*

- `items:changed` - подсчёт количества товаров в корзине;
- `card:select` - выбор карточки для отображения в модальном окне;
- `preview:changed` - обновление отображения товаров в модальном окне корзины при добавлении или удалении каждого следующего;
- `webproduct:added`- добавление товара в корзину;
- `webproduct:deletet`  - удаление товара из корзины;
- `itemsBasket:changed`- подсчёт стоимости заказа;
- `basket:open` - отображение модального окна корзины при открытии;
- `order:open` - отображение модального окна заказа при открытии;
- `payment:changed` - переключение способа оплаты при оформлении заказа;
- `order:submit` - отправка заказа;
- `formAddresErrors:change` - проверка на наличие ошибок в инпуте адреса формы;
- `formContactErrors:change` - проверка на наличие ошибок в инпуте контакта формы;
- `order.address:change`- внесение адреса при оформлении заказа;
- `contacts:submit` - отправка контактов, для оформления заказа;
- `modal:open` - открытие модального окна;
- `modal:close` - закрытие модального окна;
```

### `class LarekApi`
`LarekApi` предоставляет методы для работы с API приложения.

- **Методы:**
  - `getProductList()` — Получает список товаров.
  - `getProductItem(id: string)` — Получает информацию о товаре по ID.
  - `orderProduct(order: IOrderForm)` — Отправляет данные заказа на сервер.

